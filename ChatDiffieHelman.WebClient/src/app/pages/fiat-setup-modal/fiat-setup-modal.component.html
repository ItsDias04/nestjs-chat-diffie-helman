<div class="modal-overlay" (click)="cancel()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</h2>
      <button class="close-btn" (click)="cancel()">&times;</button>
    </div>

    <div class="modal-body">
      <!-- –®–∞–≥ 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è -->
      <div *ngIf="currentStep === 'generate'" class="step-content">
        <div class="info-block warning">
          <h3>‚ö†Ô∏è –í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
          <p>
            –í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –≤–∫–ª—é—á–∏—Ç—å –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
            –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ Fiat-Shamir.
          </p>
          <ul>
            <li>–ë—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –∫–ª—é—á–∏</li>
            <li>–í–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –±—É–¥–µ—Ç —Å–∫–∞—á–∞—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á</li>
            <li>–ë–µ–∑ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –≤—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</li>
            <li>–•—Ä–∞–Ω–∏—Ç–µ –∫–ª—é—á –≤ –Ω–∞–¥—ë–∂–Ω–æ–º –º–µ—Å—Ç–µ –∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –µ–≥–æ –¥—Ä—É–≥–∏–º</li>
          </ul>
        </div>

        <div class="action-buttons">
          <button class="btn-primary" (click)="generateKeys()">
            –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–∏
          </button>
          <button class="btn-secondary" (click)="cancel()">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </div>

      <!-- –®–∞–≥ 2: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ -->
      <div *ngIf="currentStep === 'download'" class="step-content">
        <div class="info-block success">
          <h3>‚úÖ –ö–ª—é—á–∏ —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã</h3>
          <p>
            –¢–µ–ø–µ—Ä—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º.
          </p>
        </div>

        <div class="keys-preview">
          <h4>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã Fiat-Shamir:</h4>
          <div class="keys-grid">
            <div class="key-item">
              <span class="key-label">–ú–æ–¥—É–ª—å (n):</span>
              <span class="key-value">{{ keys?.n }}</span>
            </div>
            <div class="key-item">
              <span class="key-label">–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á (v):</span>
              <span class="key-value">{{ keys?.v }}</span>
            </div>
            <div class="key-item secret">
              <span class="key-label">–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á (s):</span>
              <span class="key-value">{{ keys?.s }}</span>
              <span class="badge">–°–ï–ö–†–ï–¢–ù–û</span>
            </div>
          </div>
        </div>

        <div class="warning-box">
          <strong>‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:</strong> –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á (s) –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω
          –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º!
        </div>

        <div class="action-buttons">
          <button class="btn-primary" (click)="downloadKeys()">
            üì• –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª —Å –∫–ª—é—á–∞–º–∏
          </button>
          <button class="btn-secondary" (click)="copyToClipboard()">
            üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä
          </button>
        </div>
      </div>

      <!-- –®–∞–≥ 3: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ -->
      <div *ngIf="currentStep === 'confirm'" class="step-content">
        <div class="info-block success">
          <h3>‚úÖ –§–∞–π–ª —Å–∫–∞—á–∞–Ω</h3>
          <p>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ –Ω–∞–¥—ë–∂–Ω–æ–º –º–µ—Å—Ç–µ.</p>
        </div>

        <div class="checklist">
          <h4>–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫:</h4>
          <label class="checkbox-item">
            <input type="checkbox" />
            –Ø —Å–∫–∞—á–∞–ª —Ñ–∞–π–ª —Å –∫–ª—é—á–∞–º–∏
          </label>
          <label class="checkbox-item">
            <input type="checkbox" />
            –Ø —Å–æ—Ö—Ä–∞–Ω–∏–ª —Ñ–∞–π–ª –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ
          </label>
          <label class="checkbox-item">
            <input type="checkbox" />
            –Ø —Å–æ–∑–¥–∞–ª —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –∫–ª—é—á–∞
          </label>
          <label class="checkbox-item">
            <input type="checkbox" />
            –Ø –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ –±–µ–∑ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –Ω–µ —Å–º–æ–≥—É –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
          </label>
        </div>

        <div class="warning-box critical">
          <strong>‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:</strong>
          <p>
            –ï—Å–ª–∏ –≤—ã –ø–æ—Ç–µ—Ä—è–µ—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á, –≤—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É.
            –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
          </p>
        </div>

        <div class="action-buttons">
          <button
            class="btn-primary"
            [disabled]="!hasDownloaded"
            (click)="confirmSetup()"
          >
            –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏ –≤–∫–ª—é—á–∏—Ç—å 2FA
          </button>
          <button class="btn-secondary" (click)="downloadKeys()">
            –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª –µ—â—ë —Ä–∞–∑
          </button>
          <button class="btn-danger" (click)="cancel()">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </div>
    </div>
  </div>
</div>