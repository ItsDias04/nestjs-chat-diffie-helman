# Политика информационной безопасности

## УТВЕРЖДАЮ
**Руководитель проекта**  
_________________ (подпись)  
"__" _________ 2025 г.

---

## 1. Общие положения

### 1.1 Назначение документа
Настоящая Политика информационной безопасности (далее — Политика) определяет основные принципы, цели и задачи обеспечения информационной безопасности при эксплуатации системы **NestJS Chat с шифрованием Диффи-Хеллмана**.

### 1.2 Область действия
Политика распространяется на:
- Все информационные активы системы
- Всех сотрудников, имеющих доступ к системе
- Пользователей системы
- Подрядчиков и третьих лиц, обрабатывающих информацию

### 1.3 Нормативные основания
- ISO/IEC 27001:2022 — Системы управления информационной безопасностью
- ГОСТ Р 57580.1-2017 — Безопасность финансовых (банковских) операций
- Федеральный закон № 152-ФЗ "О персональных данных"
- Федеральный закон № 149-ФЗ "Об информации, информационных технологиях и защите информации"

---

## 2. Цели и задачи

### 2.1 Основные цели
1. **Обеспечение конфиденциальности** — защита переписки и персональных данных от несанкционированного доступа
2. **Обеспечение целостности** — предотвращение несанкционированного изменения данных
3. **Обеспечение доступности** — гарантия доступа к системе легитимным пользователям

### 2.2 Задачи
- Создание и поддержание эффективной системы управления ИБ (СУИБ)
- Минимизация рисков информационной безопасности
- Соответствие требованиям законодательства РФ
- Формирование культуры безопасности у сотрудников и пользователей

---

## 3. Принципы информационной безопасности

### 3.1 Базовые принципы
1. **Законность** — соблюдение требований российского законодательства
2. **Комплексность** — применение организационных и технических мер защиты
3. **Непрерывность** — постоянный мониторинг и совершенствование защиты
4. **Минимизация привилегий** — предоставление только необходимых прав доступа
5. **Разделение обязанностей** — распределение критичных функций между разными ролями
6. **Defense in Depth** — многоуровневая защита
7. **Security by Design** — проектирование безопасности с начала разработки

---

## 4. Классификация информации

### 4.1 Уровни конфиденциальности

| Уровень | Описание | Примеры | Меры защиты |
|---------|----------|---------|-------------|
| **ПУБЛИЧНАЯ** | Общедоступная информация | Публичная документация, маркетинг | Базовая защита от модификации |
| **ВНУТРЕННЯЯ** | Для сотрудников организации | Внутренние регламенты, архитектура | Аутентификация + авторизация |
| **КОНФИДЕНЦИАЛЬНАЯ** | Персональные данные пользователей | Email, имена, метаданные переписки | Шифрование + контроль доступа |
| **СТРОГО КОНФИДЕНЦИАЛЬНАЯ** | Критически важная информация | Пароли, криптоключи, содержание сообщений | Усиленное шифрование + логирование |

### 4.2 Обязанности по защите
Все сотрудники обязаны:
- Классифицировать создаваемую информацию
- Применять соответствующие меры защиты
- Немедленно сообщать об утечках

---

## 5. Управление доступом

### 5.1 Политика паролей

**Требования к паролям**:
- Минимальная длина: **8 символов**
- Обязательно: заглавные и строчные буквы, цифры, специальные символы
- Запрещено: словарные слова, последовательности (123456, qwerty)
- Проверка по базам утечек (Have I Been Pwned API)
- Смена пароля: каждые **90 дней**
- Запрет повторного использования: последние **5 паролей**

**Хранение паролей**:
- Хеширование: **bcrypt** (cost factor ≥ 12)
- Запрещено хранение в открытом виде
- Запрещено логирование паролей

### 5.2 Многофакторная аутентификация (MFA)

**Обязательна для**:
- Администраторов системы
- Пользователей с доступом к критичным данным
- Удаленного доступа к серверам

**Методы MFA**:
- TOTP (Time-based One-Time Password) — Google Authenticator, Authy
- SMS (для обычных пользователей)
- Hardware tokens (для администраторов)

### 5.3 Управление JWT токенами

| Параметр | Значение | Обоснование |
|----------|----------|-------------|
| **Access Token TTL** | 15 минут | Минимизация окна компрометации |
| **Refresh Token TTL** | 7 дней | Баланс безопасности и UX |
| **Хранение (Web)** | HttpOnly Cookie | Защита от XSS |
| **Хранение (Mobile)** | Secure Enclave / Keystore | Аппаратная защита |
| **Rotation** | Каждое обновление | Предотвращение replay-атак |

### 5.4 Контроль доступа (RBAC)

**Роли**:
1. **Гость** (неавторизованный)
   - Доступ: регистрация, восстановление пароля
   
2. **Пользователь** (обычный)
   - Доступ: свой профиль, свои чаты, отправка сообщений
   - Запрещено: чужие профили, чужие чаты
   
3. **Модератор**
   - Доступ: блокировка пользователей, удаление нарушающих сообщений
   
4. **Администратор**
   - Доступ: полный доступ к системе, логи, настройки
   - Обязательно: MFA, логирование всех действий

---

## 6. Криптографическая защита

### 6.1 Шифрование данных в покое (At Rest)

| Данные | Метод | Ключ |
|--------|-------|------|
| Пароли | bcrypt (cost 12) | N/A (hash) |
| Персональные данные | AES-256-GCM | Master key (rotated annually) |
| Сообщения в БД | AES-256-GCM | Per-user key |
| Резервные копии | AES-256-CBC | Backup key (offline storage) |

### 6.2 Шифрование данных в движении (In Transit)

**Обязательные требования**:
- **Протокол**: TLS 1.3 (минимум TLS 1.2)
- **Cipher Suites**: только AEAD (AES-GCM, ChaCha20-Poly1305)
- **Запрещено**: RC4, 3DES, MD5, SHA-1
- **HSTS**: `max-age=31536000; includeSubDomains; preload`
- **Certificate Pinning**: для мобильных приложений

### 6.3 Протокол Диффи-Хеллмана

**Параметры DH**:
- **Группа**: RFC 3526 Group 14 или выше (минимум 2048 бит)
- **Рекомендуется**: Group 15 (3072 бит) или Group 16 (4096 бит)
- **Генератор**: 2 или 5
- **PRNG**: Web Crypto API (crypto.getRandomValues)

**Меры безопасности**:
- Authenticated DH (с цифровыми подписями)
- Perfect Forward Secrecy (регенерация ключей каждую сессию)
- Приватные ключи НИКОГДА не покидают клиентское устройство
- Хранение приватных ключей только в памяти (не localStorage)

---

## 7. Защита от угроз

### 7.1 SQL-инъекции

**Обязательные меры**:
- ✅ Использование ORM (TypeORM/Prisma)
- ✅ Параметризованные запросы (prepared statements)
- ✅ Валидация всех входных данных (class-validator)
- ✅ WAF с правилами OWASP ModSecurity CRS
- ❌ ЗАПРЕЩЕНО: динамические SQL-запросы, конкатенация строк

**Мониторинг**:
- Автоматическое тестирование SQLMap в CI/CD
- Алерты при обнаружении SQL-паттернов в логах

### 7.2 XSS (Cross-Site Scripting)

**Технические меры**:
- Санитизация HTML на сервере (sanitize-html)
- Санитизация на клиенте (DOMPurify для Angular)
- Content Security Policy (CSP):
  ```http
  Content-Security-Policy: default-src 'self'; script-src 'self'; object-src 'none'
  ```
- Использование `textContent` вместо `innerHTML`

### 7.3 CSRF (Cross-Site Request Forgery)

**Защита**:
- CSRF токены для state-changing операций
- CORS: строгий whitelist origins
- SameSite=Strict для cookies
- Проверка Referer/Origin headers

### 7.4 Брутфорс и DoS

**Rate Limiting**:

| Endpoint | Лимит | Период | Блокировка |
|----------|-------|--------|-----------|
| `/auth/login` | 5 попыток | 15 минут | 30 минут |
| `/auth/register` | 3 регистрации | 1 час | 24 часа |
| `/messages` | 100 сообщений | 1 минута | 5 минут |
| Глобальный | 1000 запросов | 1 час | 1 час |

**DDoS защита**:
- CloudFlare / AWS Shield
- Геоблокировка (если необходимо)
- Автоматическое масштабирование

---

## 8. Логирование и мониторинг

### 8.1 Обязательное логирование

**События безопасности**:
- ✅ Успешная/неудачная аутентификация
- ✅ Изменение паролей
- ✅ Создание/удаление пользователей
- ✅ Доступ к критичным данным
- ✅ Изменение настроек безопасности
- ✅ Административные действия
- ❌ **НЕ логировать**: пароли, JWT токены, приватные ключи, полное содержание сообщений

**Формат логов**:
```json
{
  "timestamp": "2025-11-20T10:30:00Z",
  "level": "INFO",
  "event": "login_success",
  "userId": "uuid",
  "ip": "192.168.1.1",
  "userAgent": "Mozilla/5.0...",
  "geo": {"country": "RU", "city": "Moscow"}
}
```

### 8.2 Хранение логов
- **Период**: минимум **1 год** (для соответствия 152-ФЗ)
- **Централизованное хранилище**: ELK Stack / Graylog
- **Защита**: неизменяемость (write-once), шифрование
- **Резервирование**: ежедневные бэкапы

### 8.3 Мониторинг и алерты

**Критические события (алерт немедленно)**:
- 10+ неудачных попыток входа с одного IP
- Доступ к БД с неизвестного IP
- Обнаружение SQL-инъекций в логах
- Изменение критичных конфигураций
- DDoS атака (>1000 RPS)

**Инструменты**:
- SIEM: Wazuh / Splunk
- IDS/IPS: Snort / Suricata
- Uptime monitoring: Zabbix / Prometheus

---

## 9. Управление инцидентами

### 9.1 Классификация инцидентов

| Уровень | Описание | Время реакции | Пример |
|---------|----------|---------------|--------|
| **P1 - Критический** | Компрометация системы | < 1 час | Утечка БД, взлом сервера |
| **P2 - Высокий** | Недоступность сервиса | < 4 часа | DDoS, отказ критичного компонента |
| **P3 - Средний** | Локальная проблема | < 24 часа | Брутфорс отдельного аккаунта |
| **P4 - Низкий** | Подозрительная активность | < 72 часа | Необычная геолокация входа |

### 9.2 Процедура реагирования
1. **Обнаружение** — автоматический мониторинг / ручное обнаружение
2. **Сдерживание** — изоляция компроментированных систем
3. **Ликвидация** — устранение угрозы
4. **Восстановление** — возврат к нормальной работе
5. **Анализ** — post-mortem, улучшение процессов

### 9.3 Ответственные лица
- **Security Officer** — координация реагирования
- **DevOps** — технические действия
- **Legal** — юридическое сопровождение (при утечке ПДн)

---

## 10. Резервное копирование

### 10.1 Стратегия 3-2-1
- **3 копии** данных (production + 2 backup)
- **2 разных носителя** (HDD + SSD / облако)
- **1 копия offsite** (в другом ЦОД / регионе)

### 10.2 Расписание
| Тип данных | Частота | Хранение |
|------------|---------|----------|
| База данных | Ежедневно (01:00) | 30 дней |
| Конфигурации | При изменении | 90 дней |
| Логи | Ежедневно | 1 год |
| Full system | Еженедельно | 12 недель |

### 10.3 Тестирование восстановления
- **Частота**: ежемесячно
- **RTO (Recovery Time Objective)**: < 4 часа
- **RPO (Recovery Point Objective)**: < 24 часа

---

## 11. Безопасная разработка (Secure SDLC)

### 11.1 Требования к коду
- Code review: минимум 1 ревьюер перед merge
- Статический анализ: SonarQube / Semgrep в CI/CD
- Динамический анализ: OWASP ZAP в pipeline
- Dependency scanning: npm audit, Snyk

### 11.2 Управление зависимостями
```bash
# Еженедельная проверка
npm audit
npm outdated

# Автоматические обновления (Dependabot)
# Критичные уязвимости - немедленно
```

---

## 12. Обучение и осведомленность

### 12.1 Обязательное обучение

**Для разработчиков**:
- Secure Coding (OWASP Top 10) — ежегодно
- Новые угрозы — ежеквартально

**Для администраторов**:
- Hardening серверов — при найме + ежегодно
- Реагирование на инциденты — раз в полгода

**Для пользователей**:
- Безопасное использование — при регистрации
- Фишинг и социальная инженерия — памятка

### 12.2 Тестирование осведомленности
- Симуляция фишинговых атак — ежеквартально
- Оценка знаний — после обучения

---

## 13. Соответствие нормативам

### 13.1 152-ФЗ "О персональных данных"

**Обрабатываемые ПДн**:
- ФИО, email, телефон (если указан)

**Меры защиты** (согласно Приказу ФСТЭК № 21):
- ✅ Идентификация и аутентификация
- ✅ Управление доступом
- ✅ Шифрование ПДн
- ✅ Регистрация событий безопасности
- ✅ Антивирусная защита
- ✅ Резервное копирование

**Согласие пользователей**:
- Явное согласие при регистрации
- Право на доступ, изменение, удаление ПДн
- Уведомление об утечках в течение 24 часов

### 13.2 ISO 27001:2022

**Соответствие Annex A**:
- A.5 — Политики ИБ (этот документ)
- A.8 — Управление активами (см. 02-assets-map.md)
- A.9 — Контроль доступа (Раздел 5)
- A.10 — Криптография (Раздел 6)
- A.12 — Безопасность операций (Разделы 7-8)
- A.14 — Безопасная разработка (Раздел 11)
- A.16 — Управление инцидентами (Раздел 9)
- A.17 — Непрерывность бизнеса (Раздел 10)

---

## 14. Ответственность и санкции

### 14.1 Ответственность сотрудников

**За нарушения Политики**:
- Первое нарушение — письменное предупреждение
- Повторное — выговор
- Критическое (утечка данных) — увольнение + возможное уголовное преследование (УК РФ ст. 272, 273, 274)

### 14.2 Внутренний аудит
- **Периодичность**: ежеквартально
- **Проводит**: независимый аудитор ИБ
- **Охват**: все требования Политики

---

## 15. Пересмотр и актуализация

### 15.1 Плановый пересмотр
- **Периодичность**: ежегодно (декабрь)
- **Ответственный**: CISO / Security Officer

### 15.2 Внеплановый пересмотр
При:
- Изменении законодательства
- Серьезном инциденте безопасности
- Изменении архитектуры системы

---

## 16. Контактная информация

**Ответственный за ИБ**:  
Должность: Security Officer  
Email: security@company.com  
Телефон: +7 (XXX) XXX-XX-XX  

**Сообщить об инциденте**:  
Email: incident@company.com  
Телефон (24/7): +7 (XXX) XXX-XX-XX  

---

## 17. Приложения

- **Приложение А**: Форма классификации информации
- **Приложение Б**: Чек-лист реагирования на инциденты
- **Приложение В**: Шаблон отчета об инциденте
- **Приложение Г**: Согласие на обработку ПДн

---

**Версия**: 1.0  
**Дата утверждения**: 20 ноября 2025  
**Дата вступления в силу**: 20 ноября 2025  
**Дата следующего пересмотра**: 20 ноября 2026  

**Документ утвердил**:  
_________________ / ФИО Руководителя  

**Документ согласовал**:  
_________________ / ФИО Security Officer  
_________________ / ФИО Юриста  
_________________ / ФИО DPO (Data Protection Officer)
